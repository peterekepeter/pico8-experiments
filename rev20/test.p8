pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

part={};
part_c=100;
clear=true;
frame=0;
 
function _init()
	//music(0);
	for i=1,part_c do
		part[i]={
			x=rnd(128),
			y=rnd(112),
			sx=1,
			sy=0
		}
		end
end 
 
function _update60()
 part_c=48*(-cos(frame/60/8)*.5+.5);
 for i=1,part_c do
 	part[i].x+=part[i].sx;
 	part[i].y+=part[i].sy;
 end
 u_pmove();
 frame+=1
end;

function u_pmove()
	for i=1,part_c do
	 local p=part[i];
	 local x,y,sx,sy=p.x,p.y,p.sx,p.sy;
	 for q=1,10 do
		 if pget(x+sx*2,y+sy*2)>0 
		 or pget(x+sx,y+sy)>0
		 or rnd(100)<10 then
		 	local d=flr(rnd(4))/4;
			 sx = cos(d);
			 sy = sin(d);
			 if (y<i) sy=abs(sy);
			 if (y>96) sy=-abs(sy);
			 if (x<16) sx=abs(sx);
			 if (x>112) sx=-abs(sx);
		 	part[i].sx=sx;
		 	part[i].sy=sy;
		 else
		 	break;
		 end
	 end
		pset(x, y)
	end 
end

function _draw()
 if(clear)then cls(); clear=false; end
 
	for i=1,part_c do
 	color(i+frame/10);
	 local x,y = part[i].x, part[i].y;
		pset(x, y)
	end 
	for i=0,1000 do
		local x,y=rnd(128),rnd(128)
	 c=pget(x,y);
	 if (c>0) pset(x,y,c/2+.1);
	end
	for i=0,0 do
		local x=rnd(127);
		memcpy(0x6000, 0x6000+64, 0x2000-64);
	end
end;
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
011000000955309553000000955309553000000955309553095530000000000095530000000000095530000009553095530000009553095530000009553095530955300000000000955300000000000955300000
01100000095530000000000095530000000000095530000015635000002d0032d0032d0132d0132d0132d01309553000000000009553000000000009553000001563500000000000000015635156352d0132d013
0110000000035000350c03500035000350c035000350c035000350c0350c035000350c0350c035000350c0350c0350c03500035000350c0350c035000350c0350003500035000350c035000350c0350c0350c035
011000003075400751007510075100751007510075100751057510575105751057510575105751057510575100751007510075100751007510075100751007510075100751007510075100751007510075100751
011000201813118116241310c115241360c117241350c11524135241150c136241170c137241150c135241151d135181151d135181171d137181171d137181171313713115131351311513135131151313513115
__music__
01 02414344
01 02414344
00 02010344
00 02010044
00 02010344
00 02010044
00 04010302
02 04010302

